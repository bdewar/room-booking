<!DOCTYPE HTML>
<html>
<head>
	<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
<!-- Latest compiled and minified JavaScript -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="jquery.ptTimeSelect.css">
<script src="jquery.ptTimeSelect.js"></script>
</head>
<body>

	<div class="container">
		<H1>Room Booking</H1>
		<form class="form-inline" method="get" action="./room-list.html">

		<div class="form-group">
		<label for="group-size">Group Size</label>
		<select id="group-size" class="form-control" required="required">
		  <option value="1">1</option>
		  <option value="2">2</option>
		  <option value="3">3</option>
		  <option value="4">4</option>
		  <option value="5">5</option>
		</select>
		</div>

		<div class="form-group">
		<label for="preferred-time">Preferred Time</label>
		<input id="preferred-time" type="text" class="form-control">
		</div>

		<div class="form-group">
		<label for="duration">Duration</label>
		<select id="duration" class="form-control">
		  <option value="30">30 min</option>
		  <option value="60">1 hour</option>
		  <option value="120">2 hour</option>
		  <option value="720">All day</option>
		</select>
		</div>

	</form>

	<div id="room-list" class="panel-group" role="tablist"></div>
	</div>
	<script>
    var roomBooking = sessionStorage.roomBooking = {};
    roomBooking.updateList = function(){
      $('#room-list').find('.panel').each(function(){
        var $this = $(this);
        if ($this.data('hidden-by') == ''){
          $this.show();
        }
        else{
          $this.hide();
        }
      });
    };
    
    $(document).ready(function(){
 		$('#preferred-time').ptTimeSelect();

		$.getJSON('https://cyoon84.github.io/room-booking-sep8/rooms.json', function(roomdata){
    roomBooking.roomListJSON = roomdata;
    var $panelGroup = $('<div>').addClass('panel-group').attr('id', 'room-list-accordion');
		$.each(roomdata.rooms, function(idx, obj){
		  $panelGroup.append(
		    	$("<div>").addClass('panel panel-default').
          attr('id', 'panel-'+idx).
          data("minCap",obj.minCap).
          data("maxCap", obj.maxCap).
          data("minBook", obj.minBook).
          data("maxBook", obj.maxBook).
          data("roomName",obj.room).
          data("hidden-by", "").
          append(
            $("<div>").addClass('panel-heading').append(
              $('<h4>').addClass('panel-title').append(
                $("<a>").attr({
                  'role' : 'button',
                  'data-toggle' : 'collapse',
                  'data-parent' : '#room-list-accordion',
                  'href' : '#collapse-'+idx
                }).html(obj.room).addClass('collapsed')
              )
            ),
            $("<div>").attr({
            'id' : 'collapse-'+idx,
            'role': 'tabpanel'
            }).
            addClass('panel-collapse collapse').
            append(
             $('<div>').addClass('panel-body').append(
               $("<img>").attr({
                 'src' : obj.imgurl
               }).css('float', 'left'),
               $("<div>").html(obj.description),
               $("<div>").append(
                 $("<a>").attr({
                   "role" : "button",
                   "class" : "btn btn-primary"
                   "href" : "#"
                 }).html("Book this room")
               )
             )
            )
          )  
		    );
		  });
		  $("#room-list").append($panelGroup);
		});

		$('#group-size').change(function(event) {
			var group_selected = parseInt($('#group-size').val());
			$('#room-list').find('.panel').each(function(){
        var $this = $(this),
				    current_minCap = parseInt($this.data('minCap')),
				    current_maxcap = parseInt($this.data('maxCap'));
            
				if (!(group_selected >= current_minCap && group_selected <= current_maxcap)) {
          $this.data('hidden-by', $this.data('hidden-by')+':groupsize:');
				}else{
          $this.data('hidden-by', $this.data('hidden-by').replace(':groupsize:',''));
      	}
      });
      
      roomBooking.updateList();
		});

		$('#duration').change(function(event) {
			var duration_selected = parseInt($('#duration').val());
      //console.log(duration_selected);
			$('#room-list').find('.panel').each(function(){
        var $this = $(this),
				    current_minCap = parseInt($this.data('minBook')),
				    current_maxcap = parseInt($this.data('maxBook'));

        //console.log(duration_selected + ',' + current_minCap + ',' + current_maxcap);
				if (!(duration_selected >= current_minCap && duration_selected <= current_maxcap)) {
          $this.data('hidden-by', $this.data('hidden-by')+':duration:');
				}else{
          $this.data('hidden-by', $this.data('hidden-by').replace(':duration:',''));
      	}
      });
      
      roomBooking.updateList();
		});
		
	});
	</script>
</div>
</body>
</html>
