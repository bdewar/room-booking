<!DOCTYPE HTML>
<html>
<head>
	<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
<!-- Latest compiled and minified JavaScript -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="jquery.ptTimeSelect.css">
<script src="jquery.ptTimeSelect.js"></script>
</head>
<body>

	<div class="container">
		<H1>Room Booking</H1>
		<form class="form-inline" method="get" action="./room-list.html">

		<div class="form-group">
		<label for="group-size">Group Size</label>
		<select id="group-size" class="form-control" required="required">
		  <option value="1">1</option>
		  <option value="2">2</option>
		  <option value="3">3</option>
		  <option value="4">4</option>
		  <option value="5">5</option>
		</select>
		</div>

		<div class="form-group">
		<label for="preferred-time">Preferred Time</label>
		<input id="preferred-time" type="text" class="form-control">
		</div>

		<div class="form-group">
		<label for="duration">Duration</label>
		<select id="duration" class="form-control">
		  <option val="30">30 min</option>
		  <option val="60">1 hour</option>
		  <option val="120">2 hour</option>
		  <option val="9999">All day</option>
		</select>
		</div>

	</form>

	<div id="room-list" class="panel-group" role="tablist"></div>
	</div>
	<script>
	$(document).ready(function(){
		$('#preferred-time').ptTimeSelect();

		$.getJSON('https://cyoon84.github.io/room-booking-sep8/rooms.json', function(roomdata){
		console.log(roomdata);
    var $panelGroup = $('<div>').addClass('panel-group').attr('id', 'room-list-accordion');
		$.each(roomdata.rooms, function(idx, obj){
      console.log(obj);
		  $panelGroup.append(
		    	$("<div>").addClass('panel panel-default').
          data("minCap",obj.minCap).
          data("maxCap", obj.maxCap).
          data("roomName",obj.room).
          append(
            $("<div>").addClass('panel-heading').append(
              $('<h4>').addClass('panel-title').append(
                $("<a>").attr({
                  'role' : 'button',
                  'data-toggle' : 'collapse',
                  'data-parent' : '#room-list-accordion',
                  'href' : '#collapse-'+idx
                }).html(obj.room).addClass('collapsed')
              )
            ),
            $("<div>").attr({
            'id' : 'collapse-'+idx,
            'role': 'tabpanel'
            }).
            addClass('panel-collapse collapse').
            append(
             $('<div>').addClass('panel-body').html('add a full description here.')
            )
          )  
		    );
		  });
		  $("#room-list").append($panelGroup);
		});

		$('#group-size').change(function(event) {
			var group_selected = parseInt($('#group-size').val());
			console.log(group_selected);
			$('#room-list').find('.panel').each(function(){
				var current_minCap = parseInt($(this).data('minCap'));
				var current_maxcap = parseInt($(this).data('maxCap'));
				if (!(group_selected >= current_minCap && group_selected <= current_maxcap)) {
					$(this).css('display','none');
				}else{
          $(this).css('display', 'block');
      	}
      });
		});

		$('#duration').change(function(event) {

			event.preventDefault();
		});
		
    $('#room-list').on('click', '.list-group-item', function(evt){
      //alert('show details of room ' + $(this).data('roomName'))
      
    });
	});
	</script>
</div>
</body>
</html>
